# Active Context — GameCenter

Обновлено: 05.08.2025

## Текущий фокус

- Инициализирован Memory Bank проекта.
- Зафиксированы цели, продуктовый контекст, технический стек и системные паттерны.
- Готовим прозрачный обзор текущего состояния кода и ближайших шагов для MVP.

## Недавние изменения

- Созданы и заполнены:
    - memory-bank/projectbrief.md
    - memory-bank/productContext.md
    - memory-bank/systemPatterns.md
    - memory-bank/techContext.md

## Текущее состояние кода (по структуре репо)

- Компоненты: MainMenu.vue, Lobby.vue, GameField.vue
- Сторы: gameStore.ts, hostMigration.ts, counter.ts
- Сервис: services/peerService.ts (P2P/WebRTC абстракция)
- Роутер: router/index.ts
- Типы: types/game.ts
- Тесты: Vitest (unit в src/__tests__), Playwright (e2e/)
- Конфиги: vite.config.ts, vitest.config.ts, playwright.config.ts, eslint.config.ts, .prettierrc.json

## Важные договорённости

- Мутации состояния идут через Pinia actions; состояние — единый источник правды.
- peerService инкапсулирует сетевую логику; сторы подписываются на его события.
- Типы сообщений и доменные структуры — в src/types/game.ts.

## Риски и наблюдения

- P2P устойчивость: реконнекты и миграция хоста критичны для UX.
- Необходимо обеспечить идемпотентный синхрон состояния при смене хоста.
- Для e2e возможны нестабильности без моков/фикстур — учесть в планировании.

## Ближайшие шаги (очерёдность)

1) Пройтись по src/stores/gameStore.ts и hostMigration.ts: описать целевые состояния и переходы (state machine outline)
   и сверить с событиями peerService.
2) Уточнить/расширить типы сообщений в src/types/game.ts (добавить enum/дискриминирующие юнионы для P2P-пэйлоадов).
3) Проверить Lobby → GameField флоу в роутере и компонентах: старт игры, обработка отмены/выхода, гварды.
4) Добавить базовые unit-тесты для критичных action-ов сторы (создание/вход в лобби, старт игры, миграция хоста).
5) Подготовить минимальный e2e сценарий: 2 участника, старт, дисконнект хоста → миграция → продолжение.

## Открытые решения (todo)

- Протокол сообщений: версия/версионирование, форматы payload, обязательные поля.
- Политика ретраев/таймаутов в peerService (экспоненциальная задержка, лимиты).
- Стратегия ресинка состояния при подключении нового участника и после миграции.

## Индикаторы готовности текущего этапа

- Типобезопасный протокол сообщений описан и используется.
- Сторы покрыты тестами на ключевые переходы.
- e2e демонстрирует стабильный сценарий с миграцией хоста.
