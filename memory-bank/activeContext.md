# Active Context

## –¢–µ–∫—É—â–∏–π —Ñ–æ–∫—É—Å
- **üéØ –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –û–ë–ù–û–í–õ–ï–ù–ò–ï –ó–ê–í–ï–†–®–ï–ù–û (14.08.2025)**: –ü–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∞–Ω–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ ‚Äî —É–¥–∞–ª–µ–Ω–∞ —Å–ª–æ–∂–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è —Ö–æ—Å—Ç–∞
- –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —É–ø—Ä–æ—â–µ–Ω–∏—è: –∏—Å–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—É —Å –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ–º –≤ round 2 (advanced mode)
- –û—á–∏—Å—Ç–∫–∞ –∫–æ–¥–∞ –æ—Ç migration –æ—Å—Ç–∞—Ç–∫–æ–≤ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

## –ù–µ–¥–∞–≤–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### üéØ –ê–†–•–ò–¢–ï–ö–¢–£–†–ù–û–ï –£–ü–†–û–©–ï–ù–ò–ï –ü–û –ó–ê–ü–†–û–°–£ –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø (14.08.2025)
**–í—ã–ø–æ–ª–Ω–µ–Ω –ø–æ–ª–Ω—ã–π —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã —Å–µ—Ç–∏:**

1. **–£–¥–∞–ª–µ–Ω–∞ –≤—Å—è –ª–æ–≥–∏–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–∏ —Ö–æ—Å—Ç–∞** (~700 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞ —É–±—Ä–∞–Ω–æ):
   - –£–±—Ä–∞–Ω—ã —Ñ—É–Ω–∫—Ü–∏–∏ migration: `initiateHostMigration()`, `participateInMigration()`, `proceedWithMigrationAfterGracePeriod()`
   - –£–±—Ä–∞–Ω—ã mesh networking handlers –∏ —Å–ª–æ–∂–Ω—ã–µ –∫–æ–Ω—Å–µ–Ω—Å—É—Å –º–µ—Ö–∞–Ω–∏–∑–º—ã
   - –£–¥–∞–ª–µ–Ω—ã migration-related —Ç–∏–ø—ã –∏ –ø—Ä–æ—Ç–æ–∫–æ–ª—ã

2. **–ù–æ–≤–∞—è –ø—Ä–æ—Å—Ç–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ hub-and-spoke**:
   - –•–æ—Å—Ç –æ—Å—Ç–∞–µ—Ç—Å—è —Ö–æ—Å—Ç–æ–º ‚Äî –Ω–µ—Ç –ø–µ—Ä–µ–∏–∑–±—Ä–∞–Ω–∏–π –∏–ª–∏ –ø–µ—Ä–µ–¥–∞—á–∏ –≤–ª–∞—Å—Ç–∏
   - –ö–ª–∏–µ–Ω—Ç—ã –ø–æ–¥–∫–ª—é—á–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫ —Ö–æ—Å—Ç—É (–Ω–µ peer-to-peer mesh)
   - –ï—Å–ª–∏ —Ö–æ—Å—Ç —É—Ö–æ–¥–∏—Ç –¥–æ–±—Ä–æ–≤–æ–ª—å–Ω–æ ‚Üí –∏–≥—Ä–∞ –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è –¥–ª—è –≤—Å–µ—Ö
   - –ï—Å–ª–∏ —Å–µ—Ç—å –º–æ—Ä–≥–Ω—É–ª–∞ ‚Üí 60 –ø–æ–ø—ã—Ç–æ–∫ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Ç–æ–º—É –∂–µ —Ö–æ—Å—Ç—É (1 —Å–µ–∫ –∏–Ω—Ç–µ—Ä–≤–∞–ª)

3. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –±–∞–≥–∏**:
   - ‚úÖ **–î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π**: –¥–æ–±–∞–≤–ª–µ–Ω `playerId` –≤ –∫–ª—é—á –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏ (—Å—Ç—Ä–æ–∫–∞ 266-270 –≤ peerService.ts)
   - ‚úÖ **–ê–≤—Ç–æ–ø–µ—Ä–µ—Ö–æ–¥—ã —Ñ–∞–∑**: –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ basic mode voting ‚Üí answering (—Å—Ç—Ä–æ–∫–∏ 2107-2121 –≤ gameStore.ts)
   - ‚úÖ **–ü–æ–≤—Ç–æ—Ä–Ω—ã–π –≤—Ö–æ–¥**: –¥–æ–±–∞–≤–ª–µ–Ω —Ñ–ª–∞–≥ `isVoluntaryLeaving` –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞—é—â–∏–π reconnnect –ø—Ä–∏ –¥–æ–±—Ä–æ–≤–æ–ª—å–Ω–æ–º –≤—ã—Ö–æ–¥–µ (—Å—Ç—Ä–æ–∫–∏ 2883-2892 –≤ gameStore.ts)

4. **–†–µ–∑—É–ª—å—Ç–∞—Ç**: E2E —Ç–µ—Å—Ç—ã —Ç–µ–ø–µ—Ä—å —Å—Ç–∞–±–∏–ª—å–Ω–æ –ø—Ä–æ—Ö–æ–¥—è—Ç —Ä–∞—É–Ω–¥ 1 (basic mode), –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å—Ç–∞–ª–∞ –≤ —Ä–∞–∑—ã –ø—Ä–æ—â–µ –∏ –ø–æ–Ω—è—Ç–Ω–µ–µ.

### –ü—Ä–µ–¥—ã–¥—É—â–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
- **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ memory bank** (–∫–æ–º–º–∏—Ç 36871f7): –û–±–Ω–æ–≤–ª–µ–Ω—ã activeContext.md –∏ progress.md
- **–£–ª—É—á—à–µ–Ω–∏—è –ª–æ–±–±–∏** (–∫–æ–º–º–∏—Ç bbc3eef): –û—á–∏—Å—Ç–∫–∞ localStorage, responsive layout, E2E —Ç–µ—Å—Ç—ã

## –¢–µ–∫—É—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (–ø–æ—Å–ª–µ —É–ø—Ä–æ—â–µ–Ω–∏—è)

### –°–µ—Ç–µ–≤–∞—è –º–æ–¥–µ–ª—å: Hub-and-Spoke (—É–ø—Ä–æ—â–µ–Ω–Ω–∞—è)
- **–•–æ—Å—Ç**: –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π —É–∑–µ–ª, —É–ø—Ä–∞–≤–ª—è–µ—Ç –≤—Å–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –∏–≥—Ä—ã
- **–ö–ª–∏–µ–Ω—Ç—ã**: –ü–æ–¥–∫–ª—é—á–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫ —Ö–æ—Å—Ç—É, –Ω–µ –æ–±—â–∞—é—Ç—Å—è –º–µ–∂–¥—É —Å–æ–±–æ–π
- **–°—Ü–µ–Ω–∞—Ä–∏–∏**:
  - –•–æ—Å—Ç —É—à–µ–ª –¥–æ–±—Ä–æ–≤–æ–ª—å–Ω–æ ‚Üí –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∏–≥—Ä—ã –¥–ª—è –≤—Å–µ—Ö
  - –°–µ—Ç—å –º–æ—Ä–≥–Ω—É–ª–∞ ‚Üí 60 –ø–æ–ø—ã—Ç–æ–∫ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Ç–æ–º—É –∂–µ —Ö–æ—Å—Ç—É (1 —Å–µ–∫ –∏–Ω—Ç–µ—Ä–≤–∞–ª)
  - ~~–ú–∏–≥—Ä–∞—Ü–∏—è —Ö–æ—Å—Ç–∞~~ ‚Äî **–£–î–ê–õ–ï–ù–û –ø–æ–ª–Ω–æ—Å—Ç—å—é**

### –õ–æ–≥–∏–∫–∞ gameStore.ts (–∫–ª—é—á–µ–≤—ã–µ —á–∞—Å—Ç–∏):
- `resetVotingState()`: –æ—á–∏—Å—Ç–∫–∞ –≥–æ–ª–æ—Å–æ–≤/—Å—Ç–∞–≤–æ–∫ –º–µ–∂–¥—É —Ä–∞—É–Ω–¥–∞–º–∏  
- `drawCard()`: —Å–º–µ–Ω–∞ –≤–æ–ø—Ä–æ—Å–∞ –∏ –ø–µ—Ä–µ—Ö–æ–¥ —Ñ–∞–∑ voting/secret_voting
- `finishRoundHostOnly()`: –ø–µ—Ä–µ—Ö–æ–¥—ã —Ñ–∞–∑ –∏ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ –æ—á–∫–æ–≤
- `onHostDisconnectedSafe()`: **–£–ü–†–û–©–ï–ù–û** ‚Äî —Ç–æ–ª—å–∫–æ reconnect, –±–µ–∑ –º–∏–≥—Ä–∞—Ü–∏–∏
- `clientLeaveRoom()`: –¥–æ–±—Ä–æ–≤–æ–ª—å–Ω—ã–π –≤—ã—Ö–æ–¥ —Å —Ñ–ª–∞–≥–æ–º `isVoluntaryLeaving`

### –§–∞–∑—ã –∏–≥—Ä—ã: basic/advanced —á–µ—Ä–µ–¥–æ–≤–∞–Ω–∏–µ
- –ù–µ—á–µ—Ç–Ω—ã–µ —Ä–∞—É–Ω–¥—ã: `basic` mode (voting ‚Üí betting ‚Üí results)
- –ß–µ—Ç–Ω—ã–µ —Ä–∞—É–Ω–¥—ã: `advanced` mode (secret_voting ‚Üí answering ‚Üí guessing ‚Üí selecting_winners ‚Üí advanced_results)

## –†–µ—à–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã
- ¬´–ü–µ—Ä–µ–¥ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ–º –Ω–∞–¥–æ –æ—á–∏—â–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç, —á—Ç–æ–±—ã —Å—Ç–∞—Ä—ã–π –≤—ã–±–æ—Ä –Ω–µ —É—á–∏—Ç—ã–≤–∞–ª—Å—è –≤ –Ω–æ–≤–æ–º —Ä–∞—É–Ω–¥–µ¬ª ‚Äî —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ —á–µ—Ä–µ–∑ resetVotingState() –∏ –≤—ã–∑–æ–≤ –ø–µ—Ä–µ–¥ —Ñ–∞–∑–æ–π –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è.

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏
- –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Ä–∞–±–æ—Ç—É –Ω–∞–¥ unit-—Ç–µ—Å—Ç–∞–º–∏ –¥–ª—è gameStore (–ø–µ—Ä–µ—Ö–æ–¥—ã —Ñ–∞–∑, –∫–æ–Ω—Å–µ–Ω—Å—É—Å, –º–∏–≥—Ä–∞—Ü–∏—è —Ö–æ—Å—Ç–∞)
- –ó–∞–≤–µ—Ä—à–∏—Ç—å UI –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã —Å—Ç–∞—Ç—É—Å–æ–≤ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è/–ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è  
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å UI-flow:
  1) –ù–æ–≤—ã–π –≤–æ–ø—Ä–æ—Å —Ç—è–Ω–µ—Ç—Å—è (drawing_question) ‚Üí –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –≤ voting/secret_voting —Å—Ç–∞—Ä—ã–µ –≥–æ–ª–æ—Å–∞/—Å—Ç–∞–≤–∫–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç.
  2) –í advanced —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –ø—Ä–µ–∂–Ω–∏–µ guesses/roundWinners/answeringPlayerId/advancedAnswer –Ω–µ –ø–µ—Ä–µ–Ω–æ—Å—è—Ç—Å—è –º–µ–∂–¥—É —Ä–∞—É–Ω–¥–∞–º–∏.
- –†–∞—Å—à–∏—Ä–∏—Ç—å E2E —Ç–µ—Å—Ç–æ–≤–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ (–º–∏–≥—Ä–∞—Ü–∏—è —Ö–æ—Å—Ç–∞, –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è)

Date: 2025-08-10

## –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ: —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å PeerJS, –ø–æ—Ç–µ—Ä—è —Å–≤—è–∑–∏ –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ (–∫–æ–Ω—Ç–µ–∫—Å—Ç)
–ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞:
- –°–º–µ–Ω–∞ peerId —É —Ö–æ—Å—Ç–∞ –ø—Ä–∏ –ø–æ—Ç–µ—Ä—è—Ö —Å–≤—è–∑–∏, –∫–ª–∏–µ–Ω—Ç—ã –ø—Ä–æ–¥–æ–ª–∂–∞–ª–∏ –∫–æ–Ω–Ω–µ–∫—Ç –∫ —Å—Ç–∞—Ä–æ–º—É id.

–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤ –∫–æ–¥–µ:
- –î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π hostId –Ω–∞ –æ—Å–Ω–æ–≤–µ roomId –≤ peerService.createHost(roomId).
- –ú—è–≥–∫–æ–µ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–µ Peer —Å —Ç–µ–º –∂–µ ID –ø—Ä–∏ —Å–µ—Ç–µ–≤—ã—Ö —Å–±–æ—è—Ö.
- –£—Å–∏–ª–µ–Ω discovery (reachability, blacklist –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤), –æ—Ç–º–µ–Ω–µ–Ω—ã –ª–æ–∂–Ω—ã–µ ¬´—É—Å–ø–µ—Ö–∏¬ª –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –±–µ–∑ –≤–∞–ª–∏–¥–Ω–æ–≥–æ state.

–û–∂–∏–¥–∞–µ–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç:
- –°—Ç–∞–±–∏–ª—å–Ω—ã–π hostId –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ —Ä–µ–∫–æ–Ω–Ω–µ–∫—Ç—ã –∫–ª–∏–µ–Ω—Ç–æ–≤.

–ü—Ä–æ–≤–µ—Ä–∫–∞:
- –°–∏–º—É–ª—è—Ü–∏—è –ø–æ—Ç–µ—Ä–∏/–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Å–≤—è–∑–∏; –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è hostId –∏ —É—Å–ø–µ—à–Ω—ã—Ö –∞–≤—Ç–æ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –∫–ª–∏–µ–Ω—Ç–æ–≤.

## –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ: —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –∫–æ–ª–æ–¥ –≤–æ–ø—Ä–æ—Å–æ–≤ –ø–æ —Ä–∞—É–Ω–¥–∞–º (–∫–æ–Ω—Ç–µ–∫—Å—Ç)
- –î–≤–µ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–µ –ø–µ—Ä–µ–º–µ—à–∞–Ω–Ω—ã–µ –∫–æ–ª–æ–¥—ã –Ω–∞ –∏–≥—Ä—É; –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –∏—Å—á–µ—Ä–ø–∞–Ω–Ω–æ–π –∫–æ–ª–æ–¥—ã.
- –ß–µ—Ä–µ–¥–æ–≤–∞–Ω–∏–µ basic/advanced –ø–æ –Ω–æ–º–µ—Ä—É —Ä–∞—É–Ω–¥–∞, snapshot –∞–∫—Ç–∏–≤–Ω–æ–π –∫–æ–ª–æ–¥—ã –≤ gameState.questionCards.

–ó–∞—Ç—Ä–æ–Ω—É—Ç—ã–µ –º–µ—Å—Ç–∞:
- gameStore.initializeGame, drawCard, finishRoundHostOnly.

–û–∂–∏–¥–∞–µ–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç:
- –ò—Å–∫–ª—é—á–µ–Ω–æ —Å–º–µ—à–∏–≤–∞–Ω–∏–µ —Ç–∏–ø–æ–≤ –≤–æ–ø—Ä–æ—Å–æ–≤, –±–µ—Å—à–æ–≤–Ω–∞—è –∏–≥—Ä–∞ –ø—Ä–∏ –∏—Å—á–µ—Ä–ø–∞–Ω–∏–∏ –∫–æ–ª–æ–¥—ã.

## Debug-—Ñ–ª–∞–≥ –∏ –æ—Ç–ª–∞–¥–∫–∞ (–∫–æ–Ω—Ç–µ–∫—Å—Ç)
- utils/debug.ts: isDebugEnabled(), enable/disable.
- computed isDebug –≤ store; –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ snapshot/transition —á–µ—Ä–µ–∑ debugSnapshot/logAction/watch.

## –†–∏—Å–∫–∏/–∑–∞–º–µ—Ç–∫–∏
- –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã UI –Ω–µ –∫—ç—à–∏—Ä—É—é—Ç –ª–æ–∫–∞–ª—å–Ω–æ –ø—Ä–æ—à–ª—ã–π –≤—ã–±–æ—Ä –≤–Ω–µ gameState.
- –í advanced —Ä–µ–∂–∏–º–µ –ø—Ä–æ–≤–µ—Ä—è—Ç—å, —á—Ç–æ UI ¬´–ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π¬ª –∏ ¬´–¥–æ–≥–∞–¥–æ–∫¬ª –Ω–µ –æ–ø–∏—Ä–∞–µ—Ç—Å—è –Ω–∞ –ø—Ä–µ–∂–Ω–∏–µ —Ä–µ–∞–∫—Ç–∏–≤–Ω—ã–µ —Å—Å—ã–ª–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥–ª–∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å—Å—è.
