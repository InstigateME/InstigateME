# Progress — GameCenter

Обновлено: 05.08.2025

## Что уже сделано
- Инициализирован Memory Bank:
  - projectbrief.md — цели и критерии MVP.
  - productContext.md — ценность для пользователя и потоки.
  - systemPatterns.md — архитектурные и организационные паттерны.
  - techContext.md — стек, структура, соглашения.
  - activeContext.md — текущий фокус, ближайшие шаги.
- В репозитории присутствуют:
  - Компоненты: MainMenu, Lobby, GameField.
  - Сторы: gameStore, hostMigration, counter.
  - Сервис: peerService (P2P/WebRTC абстракция).
  - Роутер: router/index.ts.
  - Типы: types/game.ts.
  - Тестовая инфраструктура: Vitest (unit), Playwright (e2e).

## Что осталось (MVP дорожная карта)
1) Типобезопасный протокол сообщений P2P:
   - Описать типы/юнионы для сообщений (lobby, game, host-migration).
   - Внедрить в peerService и сторы.
2) Машина состояний игры:
   - Явно зафиксировать состояния/переходы в gameStore/hostMigration.
   - Обработать реконнекты и смену хоста.
3) Навигационный флоу:
   - Проверить гварды и корректный переход Lobby → GameField → выход.
4) Тесты:
   - Unit на ключевые action-ы сторы (создание/вход в лобби, старт, миграция).
   - Минимальный e2e: 2 игрока, старт, дисконнект хоста → миграция → продолжение.
5) UI/UX индикаторы:
   - Состояние соединения, ожидание, реконнект, смена хоста.

## Риски/блокеры
- Стабильность P2P в разных сетях (NAT, ICE).
- Идемпотентность синхронизации состояния при миграции.
- Флаки e2e без изоляции/моков.

## Метрики статуса
- [ ] Протокол сообщений типизирован и используется в peerService/stores.
- [ ] Машина состояний покрывает основные переходы и миграцию.
- [ ] Unit‑тесты на критичные переходы проходят.
- [ ] e2e сценарий миграции хоста стабилен.
- [ ] UI показывает статусы соединения/реконнектов.

## Следующие конкретные действия
- Описать enum/юнит‑типы сообщений в src/types/game.ts и согласовать формат payload.
- Провести ревизию gameStore.ts/hostMigration.ts: зафиксировать переходы и предусмотреть идемпотентный ресинк.
- Наметить тест‑кейсы для Vitest и базовый e2e плейбук.
